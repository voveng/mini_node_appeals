# Appeals App - Улучшенное тестовое задание по Node.js

Это приложение для управления обращениями, разработанное на Node.js с использованием Express и Sequelize. Проект был значительно улучшен с акцентом на лучшие практики разработки, типобезопасность, валидацию данных и удобство сопровождения.

## Содержание

- [Технологии](#технологии)
- [Требования](#требования)
- [Установка](#установка)
- [Конфигурация](#конфигурация)
- [Запуск приложения](#запуск-приложения)
  - [Режим разработки](#режим-разработки)
  - [Режим продакшена](#режим-продакшена)
- [Структура проекта](#структура-проекта)
- [API Эндпоинты](#api-эндпоинты)
- [Логирование](#логирование)
- [Рекомендации по развертыванию](#рекомендации-по-развертыванию)

## Технологии

-   **Node.js**
-   **TypeScript**
-   **Express.js** - Веб-фреймворк
-   **Sequelize** - ORM для работы с базой данных (SQLite in-memory)
-   **Zod** - Библиотека для валидации схем
-   **Winston** - Мощная библиотека для логирования
-   **Dotenv** - Для управления переменными окружения
-   **Nodemon** - Для автоматического перезапуска сервера в режиме разработки
-   **Tsc-alias** - Для разрешения алиасов путей в скомпилированном коде

## Требования

Перед началом убедитесь, что у вас установлены следующие компоненты:

-   [Node.js](https://nodejs.org/) (рекомендуемая версия: LTS)
-   npm (обычно устанавливается вместе с Node.js)
-   Git

## Установка

1.  **Клонируйте репозиторий:**

    ```bash
    git clone git@github.com:gluuck/mini_node_appeals.git
    cd mini_node_appeals
    ```

2.  **Установите зависимости:**

    ```bash
    npm install
    ```

## Конфигурация

Создайте файл `.env` в корне проекта на основе `.env.example` (если он будет создан) или вручную.

Пример `.env`:

```
PORT=3000
NODE_ENV=development # или production
```

-   `PORT`: Порт, на котором будет работать сервер.
-   `NODE_ENV`: Режим работы приложения (`development` или `production`). Влияет на уровень логирования.

## Запуск приложения

### Режим разработки

Для запуска сервера в режиме разработки с автоматическим перезапуском при изменениях:

```bash
npm run dev
```

Сервер будет доступен по адресу `http://localhost:3000` (или по порту, указанному в `.env`).

### Режим продакшена

1.  **Скомпилируйте проект:**

    ```bash
    npm run build
    ```

2.  **Запустите скомпилированное приложение:**

    ```bash
    npm run start
    ```

## Структура проекта

Проект организован следующим образом:

```
.
├── dist/                 # Скомпилированный JavaScript код
├── node_modules/         # Установленные зависимости
├── src/
│   ├── config/           # Конфигурационные файлы
│   │   └── config.ts     # Основная конфигурация приложения
│   ├── controllers/      # Обработчики запросов (логика контроллеров)
│   │   └── appeal.controller.ts
│   ├── models/           # Определение моделей Sequelize
│   │   └── appeal.model.ts
│   ├── routes/           # Определение маршрутов API
│   │   └── appeal.routes.ts
│   ├── services/         # Бизнес-логика (взаимодействие с моделями)
│   │   └── appeal.service.ts
│   ├── utils/            # Вспомогательные утилиты
│   │   └── logger.ts     # Настройка логирования Winston
│   ├── app.ts            # Основной файл Express приложения
│   └── server.ts         # Точка входа сервера
├── .env                  # Переменные окружения (не отслеживается Git)
├── .gitignore            # Файлы и папки, игнорируемые Git
├── package.json          # Описание проекта и зависимости
├── tsconfig.json         # Конфигурация TypeScript
└── README.md             # Этот файл
```

## API Эндпоинты

Ниже представлено описание доступных API эндпоинтов:

-   **`GET /appeals`**
    -   **Описание:** Получает список обращений со статусом "New" (Новое).
    -   **Метод:** `GET`
    -   **Параметры запроса:** Нет
    -   **Ответ:** `200 OK` - Массив объектов обращений.

-   **`POST /appeals`**
    -   **Описание:** Создает новое обращение.
    -   **Метод:** `POST`
    -   **Тело запроса:**
        ```json
        {
          "theme": "string",
          "message": "string"
        }
        ```
    -   **Валидация:** Поля `theme` и `message` обязательны и не могут быть пустыми строками.
    -   **Ответ:** `201 Created` - Объект созданного обращения.
    -   **Ошибки:** `400 Bad Request` - Если `theme` или `message` пусты.

-   **`PATCH /appeals/:id/start`**
    -   **Описание:** Начинает обработку обращения, изменяя его статус на "InProgress" (В процессе).
    -   **Метод:** `PATCH`
    -   **Параметры пути:** `:id` (число) - ID обращения.
    -   **Ответ:** `200 OK` - Объект обновленного обращения.
    -   **Ошибки:** `500 Internal Server Error` - Если обращение не найдено или произошла другая ошибка.

-   **`PATCH /appeals/:id/complete`**
    -   **Описание:** Завершает обращение, изменяя его статус на "Completed" (Завершено) и добавляя решение.
    -   **Метод:** `PATCH`
    -   **Параметры пути:** `:id` (число) - ID обращения.
    -   **Тело запроса:**
        ```json
        {
          "solution": "string"
        }
        ```
    -   **Ответ:** `200 OK` - Объект обновленного обращения.
    -   **Ошибки:** `500 Internal Server Error` - Если обращение не найдено или произошла другая ошибка.

-   **`PATCH /appeals/:id/cancel`**
    -   **Описание:** Отменяет обращение, изменяя его статус на "Cancelled" (Отменено) и добавляя причину.
    -   **Метод:** `PATCH`
    -   **Параметры пути:** `:id` (число) - ID обращения.
    -   **Тело запроса:**
        ```json
        {
          "reason": "string"
        }
        ```
    -   **Ответ:** `200 OK` - Объект обновленного обращения.
    -   **Ошибки:** `500 Internal Server Error` - Если обращение не найдено или произошла другая ошибка.

-   **`POST /appeals/cancel-all-in-progress`**
    -   **Описание:** Отменяет все обращения, находящиеся в статусе "InProgress".
    -   **Метод:** `POST`
    -   **Параметры запроса:** Нет
    -   **Ответ:** `200 OK` - Массив объектов отмененных обращений.
    -   **Ошибки:** `500 Internal Server Error` - Если произошла ошибка при отмене обращений.

-   **`GET /appeals/by-dates`**
    -   **Описание:** Получает обращения, отфильтрованные по дате создания или диапазону дат.
    -   **Метод:** `GET`
    -   **Тело запроса (один из вариантов):**
        ```json
        {
          "date": "YYYY-MM-DD"
        }
        ```
        Или:
        ```json
        {
          "startDate": "YYYY-MM-DD",
          "endDate": "YYYY-MM-DD"
        }
        ```
    -   **Ответ:** `200 OK` - Массив объектов обращений, соответствующих фильтрам.
    -   **Ошибки:** `500 Internal Server Error` - Если произошла ошибка при получении обращений.

## Логирование

В проекте используется **Winston** для логирования.

-   В режиме `development` логи выводятся в консоль с цветовой разметкой.
-   В режиме `production` логи выводятся в формате JSON, что удобно для парсинга и анализа внешними системами логирования.
-   Используются уровни логирования `info` (для успешных операций и старта сервера) и `error` (для ошибок).

